<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Rockongo1 Predictor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,700&display=swap" rel="stylesheet">

</head>
<body class="bg-light">

<div class="container mt-5">
    <!-- Encabezado ROCKDATA -->
<div class="text-center mb-4">
  <img src="{{ url_for('static', filename='logo_rockdata.png') }}" alt="RockData Logo" width="150" class="mb-2">
    <p style="font-family: 'Playfair Display', serif; font-style: italic; font-weight: bold; font-size: 1.2rem;" class="text-muted">
    No adivinamos. Calculamos.
  </p>
</div>


    <div class="card shadow p-4 mb-4">
        <form method="post">
            <div class="row mb-3">
                <div class="col-md-4">
                    <label for="pais" class="form-label">Pa√≠s:</label>
                    <select name="pais" id="pais" class="form-select" required>
                        <option value="">-- Selecciona un pa√≠s --</option>
                        {% for p in paises %}
                            <option value="{{ p }}">{{ p }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="liga" class="form-label">Liga:</label>
                    <select name="liga" id="liga" class="form-select" required disabled>
                        <option value="">-- Selecciona una liga --</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="equipo_local" class="form-label">Equipo Local:</label>
                    <select name="equipo_local" id="equipo_local" class="form-select" required disabled>
                        <option value="">-- Selecciona equipo local --</option>
                    </select>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-md-6">
                    <label for="equipo_visita" class="form-label">Equipo Visita:</label>
                    <select name="equipo_visita" id="equipo_visita" class="form-select" required disabled>
                        <option value="">-- Selecciona equipo visita --</option>
                    </select>
                </div>
                <div class="col-md-6 d-grid">
                    <label class="form-label invisible">.</label>
                    <button type="submit" class="btn btn-primary btn-lg">üîç Predecir</button>
                </div>
            </div>
        </form>
    </div>

    {% if resultado %}
        <div class="card shadow p-4">
  <div class="text-center mb-4 mt-5">
    <img src="{{ url_for('static', filename='logo_rockdata.png') }}" alt="RockData Logo" width="160" class="mb-2">
    <h1 class="display-5 fw-bold text-dark">ROCKDATA</h1>
    <p style="font-family: 'Playfair Display', serif; font-style: italic; font-weight: bold; font-size: 1.2rem;" class="text-muted">
      No adivinamos. Calculamos.
    </p>
  </div>
            <h4 class="mb-3 text-primary">üìä Resultados de Predicci√≥n</h4>
            <ul class="list-group">
                <li class="list-group-item">‚öΩ Goles en Primer Tiempo: <strong>{{ resultado['Goles 1T'] }}</strong></li>
                <li class="list-group-item">‚öΩ Goles en Segundo Tiempo: <strong>{{ resultado['Goles 2T'] }}</strong></li>
                <li class="list-group-item">üéØ Total Goles Esperados: <strong>{{ resultado['Goles Totales'] }}</strong></li>
                <li class="list-group-item">üü® Tarjetas Amarillas: <strong>{{ resultado['Tarjetas Promedio'] }}</strong></li>
                <li class="list-group-item">üü• Tarjetas Rojas: <strong>{{ resultado['Rojas'] }}</strong></li>
                <li class="list-group-item">üè≥Ô∏è C√≥rners Totales: <strong>{{ resultado['Corners'] }}</strong></li>
                <li class="list-group-item">üè† Fortaleza Local (√∫ltimos 10): <strong>{{ resultado['Fortaleza Local'] }}%</strong></li>
                <li class="list-group-item">üõ´ Fortaleza Visita (√∫ltimos 10): <strong>{{ resultado['Fortaleza Visita'] }}%</strong></li>
                <li class="list-group-item bg-success-subtle">üß† <strong>Pron√≥stico Final: {{ resultado['Pron√≥stico'] }}</strong></li>
            </ul>
{% if sugerencias %}
<div class="card shadow p-3 mt-4">
    <h5 class="card-title text-primary">üß† Sugerencias de Apuesta</h5>
    <ul class="list-group list-group-flush">
        {% for sugerencia in sugerencias %}
            <li class="list-group-item">‚úîÔ∏è {{ sugerencia }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

        </div>
    {% endif %}
<!-- Bot√≥n para mostrar la simulaci√≥n -->
<div style="display: flex; justify-content: flex-end; margin-top: 10px;">
  <button onclick="toggleSimulacion()" style="padding: 6px 12px; background-color: #eef6fb; border: none; border-radius: 5px; cursor: pointer;">
    üìä Ver forma reciente
  </button>
</div>

<!-- Contenedor oculto de la simulaci√≥n -->
<div id="simulacionBox" style="display: none; margin-top: 10px; border: 1px solid #ddd; padding: 10px; border-radius: 5px; background-color: #f9f9f9;">
  <h5>üïµÔ∏è Simulaci√≥n por Forma Reciente</h5>
  <div id="formaLocal"></div>
  <div id="formaVisita" style="margin-top: 8px;"></div>
</div>

<script>
  function toggleSimulacion() {
    const box = document.getElementById("simulacionBox");
    box.style.display = box.style.display === "none" ? "block" : "none";
  }

  fetch("/forma_reciente")
    .then(r => r.json())
    .then(data => {
      const f = data.forma_reciente;
      document.getElementById("formaLocal").innerHTML = `
        <strong>LOCAL ‚Äì √öltimos 5 partidos:</strong><br>
        Goles: ${f.local.goles} | Goles 1T: ${f.local.goles_1t} | Goles 2T: ${f.local.goles_2t}<br>
        C√≥rners: ${f.local.corners} | Amarillas: ${f.local.amarillas} | Rojas: ${f.local.rojas}
      `;
      document.getElementById("formaVisita").innerHTML = `
        <strong>VISITA ‚Äì √öltimos 5 partidos:</strong><br>
        Goles: ${f.visita.goles} | Goles 1T: ${f.visita.goles_1t} | Goles 2T: ${f.visita.goles_2t}<br>
        C√≥rners: ${f.visita.corners} | Amarillas: ${f.visita.amarillas} | Rojas: ${f.visita.rojas}
      `;
    });
</script>

</div>

<script>
    $(document).ready(function () {
        $("#pais").change(function () {
            let pais = $(this).val();
            $("#liga").prop("disabled", true).html('<option>-- Cargando ligas --</option>');
            $("#equipo_local, #equipo_visita").prop("disabled", true).html('<option>-- Esperando liga --</option>');

            $.ajax({
                url: "/get_ligas",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify({ pais: pais }),
                success: function (ligas) {
                    let options = '<option value="">-- Selecciona una liga --</option>';
                    ligas.forEach(liga => {
                        options += `<option value="${liga}">${liga}</option>`;
                    });
                    $("#liga").html(options).prop("disabled", false);
                }
            });
        });

        $("#liga").change(function () {
            let pais = $("#pais").val();
            let liga = $(this).val();

            $("#equipo_local, #equipo_visita").prop("disabled", true).html('<option>-- Cargando equipos --</option>');

            $.ajax({
                url: "/get_equipos",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify({ pais: pais, liga: liga }),
                success: function (equipos) {
                    let options = '<option value="">-- Selecciona equipo --</option>';
                    equipos.forEach(equipo => {
                        options += `<option value="${equipo}">${equipo}</option>`;
                    });
                    $("#equipo_local, #equipo_visita").html(options).prop("disabled", false);
                }
            });
        });
    });
</script>
<!-- Bot√≥n -->


<!-- Contenedor de resultados -->


<!-- Script -->
<script>

    fetch('/forma_reciente')
    .then(response => response.json())
    .then(data => {
        const resultadosDiv = document.getElementById('resultadosForma');
        const forma = data.forma_reciente;

        let html = '<h3>üìä Forma Reciente</h3>';
        ['local', 'visita'].forEach(equipo => {
            html += `<h4>${equipo.toUpperCase()}</h4><ul>`;
            for (const [clave, valor] of Object.entries(forma[equipo])) {
                html += `<li><b>${clave}</b>: ${valor}</li>`;
            }
            html += '</ul>';
        });

        resultadosDiv.innerHTML = html;
    })
    .catch(err => {
        alert("Error al cargar forma reciente");
        console.error(err);
    });
}
</script>

</body>
</html>

